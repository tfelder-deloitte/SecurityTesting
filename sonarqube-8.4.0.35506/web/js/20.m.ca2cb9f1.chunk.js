(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{1893:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return I}));var s=n(2),a=n(332),r=n(347),o=n.n(r),i=n(350),l=n.n(i),c=n(31),u=n(686),m=n(333),d=n(312),p=n(318),h=n.n(p),g=n(335),b=n.n(g);class E extends s.PureComponent{constructor(e){super(e),this.handleSubmit=()=>this.props.onSubmit({description:this.state.description,name:this.state.name}).then(this.props.onClose),this.handleDescriptionChange=e=>{this.setState({description:e.currentTarget.value})},this.handleNameChange=e=>{this.setState({name:e.currentTarget.value})},this.state={description:e.group&&e.group.description||"",name:e.group&&e.group.name||""}}render(){return s.createElement(b.a,{header:this.props.header,onClose:this.props.onClose,onSubmit:this.handleSubmit,size:"small"},({onCloseClick:e,onFormSubmit:t,submitting:n})=>s.createElement("form",{onSubmit:t},s.createElement("header",{className:"modal-head"},s.createElement("h2",null,this.props.header)),s.createElement("div",{className:"modal-body"},s.createElement("div",{className:"modal-field"},s.createElement("label",{htmlFor:"create-group-name"},Object(c.translate)("name"),s.createElement("em",{className:"mandatory"},"*")),s.createElement("input",{autoFocus:!0,id:"create-group-name",maxLength:255,name:"name",onChange:this.handleNameChange,required:!0,size:50,type:"text",value:this.state.name})),s.createElement("div",{className:"modal-field"},s.createElement("label",{htmlFor:"create-group-description"},Object(c.translate)("description")),s.createElement("textarea",{id:"create-group-description",name:"description",onChange:this.handleDescriptionChange,value:this.state.description}))),s.createElement("footer",{className:"modal-foot"},s.createElement(h.a,{className:"spacer-right",loading:n}),s.createElement(d.SubmitButton,{disabled:n},this.props.confirmButtonText),s.createElement(d.ResetButtonLink,{onClick:e},Object(c.translate)("cancel")))))}}class f extends s.PureComponent{constructor(){super(...arguments),this.mounted=!1,this.state={createModal:!1},this.handleCreateClick=()=>{this.setState({createModal:!0})},this.handleClose=()=>{this.mounted&&this.setState({createModal:!1})},this.handleSubmit=e=>this.props.onCreate(e)}componentDidMount(){this.mounted=!0}componentWillUnmount(){this.mounted=!1}render(){return s.createElement(s.Fragment,null,s.createElement("header",{className:"page-header",id:"groups-header"},s.createElement("h1",{className:"page-title"},Object(c.translate)("user_groups.page")),s.createElement(h.a,{loading:this.props.loading}),s.createElement("div",{className:"page-actions"},s.createElement(d.Button,{id:"groups-create",onClick:this.handleCreateClick},Object(c.translate)("groups.create_group"))),s.createElement("p",{className:"page-description"},Object(c.translate)("user_groups.page.description"))),this.state.createModal&&s.createElement(E,{confirmButtonText:Object(c.translate)("create"),header:Object(c.translate)("groups.create_group"),onClose:this.handleClose,onSubmit:this.handleSubmit}))}}var O=n(329),j=n.n(O),S=n(380),C=n.n(S),N=n(9);function y({group:e,onClose:t,onSubmit:n}){const a=Object(c.translate)("groups.delete_group");return s.createElement(b.a,{header:a,onClose:t,onSubmit:n},({onCloseClick:t,onFormSubmit:n,submitting:r})=>s.createElement("form",{onSubmit:n},s.createElement("header",{className:"modal-head"},s.createElement("h2",null,a)),s.createElement("div",{className:"modal-body"},Object(c.translateWithParameters)("groups.delete_group.confirmation",e.name)),s.createElement("footer",{className:"modal-foot"},s.createElement(h.a,{className:"spacer-right",loading:r}),s.createElement(d.SubmitButton,{className:"button-red",disabled:r},Object(c.translate)("delete")),s.createElement(d.ResetButtonLink,{disabled:r,onClick:t},Object(c.translate)("cancel")))))}var v=n(588),w=n.n(v),D=n(358),k=n.n(D),z=n(504),P=n.n(z),F=n(330),_=n.n(F),M=n(480),U=n.n(M);class x extends s.PureComponent{constructor(e){super(e),this.mounted=!1,this.fetchUsers=e=>Object(u.d)({name:this.props.group.name,organization:this.props.organization,p:e.page,ps:e.pageSize,q:""!==e.query?e.query:void 0,selected:e.filter}).then(t=>{this.mounted&&this.setState(n=>{const s=null!=e.page&&e.page>1,a=s?[...n.users,...t.users]:t.users,r=t.users.filter(e=>e.selected).map(e=>e.login),o=s?[...n.selectedUsers,...r]:r;return{needToReload:!1,lastSearchParams:e,loading:!1,users:a,usersTotalCount:t.total,selectedUsers:o}})}),this.handleSelect=e=>Object(u.a)({name:this.props.group.name,login:e,organization:this.props.organization}).then(()=>{this.mounted&&this.setState(t=>({needToReload:!0,selectedUsers:[...t.selectedUsers,e]}))}),this.handleUnselect=e=>Object(u.e)({name:this.props.group.name,login:e,organization:this.props.organization}).then(()=>{this.mounted&&this.setState(t=>({needToReload:!0,selectedUsers:k()(t.selectedUsers,e)}))}),this.renderElement=e=>{const t=P()(this.state.users,{login:e});return s.createElement("div",{className:"select-list-list-item"},void 0===t?e:s.createElement(s.Fragment,null,t.name,s.createElement("br",null),s.createElement("span",{className:"note"},t.login)))},this.state={needToReload:!1,users:[],selectedUsers:[]}}componentDidMount(){this.mounted=!0}componentWillUnmount(){this.mounted=!1}render(){const e=Object(c.translate)("users.update");return s.createElement(_.a,{contentLabel:e,onRequestClose:this.props.onClose},s.createElement("header",{className:"modal-head"},s.createElement("h2",null,e)),s.createElement("div",{className:"modal-body modal-container"},s.createElement(U.a,{elements:this.state.users.map(e=>e.login),elementsTotalCount:this.state.usersTotalCount,needToReload:this.state.needToReload&&this.state.lastSearchParams&&this.state.lastSearchParams.filter!==M.SelectListFilter.All,onSearch:this.fetchUsers,onSelect:this.handleSelect,onUnselect:this.handleUnselect,renderElement:this.renderElement,selectedElements:this.state.selectedUsers,withPaging:!0})),s.createElement("footer",{className:"modal-foot"},s.createElement(d.ResetButtonLink,{onClick:this.props.onClose},Object(c.translate)("Done"))))}}class q extends s.PureComponent{constructor(){super(...arguments),this.mounted=!1,this.state={modal:!1},this.handleMembersClick=()=>{this.setState({modal:!0})},this.handleModalClose=()=>{this.mounted&&(this.setState({modal:!1}),this.props.onEdit())}}componentDidMount(){this.mounted=!0}componentWillUnmount(){this.mounted=!1}render(){return s.createElement(s.Fragment,null,s.createElement(d.ButtonIcon,{className:"button-small",onClick:this.handleMembersClick},s.createElement(w.a,null)),this.state.modal&&s.createElement(x,{group:this.props.group,onClose:this.handleModalClose,organization:this.props.organization}))}}function T(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,s)}return n}function R(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class L extends s.PureComponent{constructor(){super(...arguments),this.mounted=!1,this.state={deleteForm:!1,editForm:!1},this.handleDeleteClick=()=>{this.setState({deleteForm:!0})},this.handleEditClick=()=>{this.setState({editForm:!0})},this.closeDeleteForm=()=>{this.mounted&&this.setState({deleteForm:!1})},this.closeEditForm=()=>{this.mounted&&this.setState({editForm:!1})},this.handleDeleteFormSubmit=()=>this.props.onDelete(this.props.group.name),this.handleEditFormSubmit=({name:e,description:t})=>{const{group:n}=this.props;return this.props.onEdit(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?T(Object(n),!0).forEach((function(t){R(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):T(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({description:t,id:n.id},Object(N.omitNil)({name:e!==n.name?e:void 0})))}}componentDidMount(){this.mounted=!0}componentWillUnmount(){this.mounted=!1}render(){const{group:e}=this.props;return s.createElement("tr",{"data-id":e.id},s.createElement("td",{className:" width-20"},s.createElement("strong",{className:"js-group-name"},e.name),e.default&&s.createElement("span",{className:"little-spacer-left"},"(",Object(c.translate)("default"),")")),s.createElement("td",{className:"width-10"},s.createElement("div",{className:"display-flex-center"},s.createElement("span",{className:"spacer-right"},e.membersCount),!e.default&&s.createElement(q,{group:e,onEdit:this.props.onEditMembers,organization:this.props.organization}))),s.createElement("td",{className:"width-40"},s.createElement("span",{className:"js-group-description"},e.description)),s.createElement("td",{className:"thin nowrap text-right"},!e.default&&s.createElement(C.a,null,s.createElement(S.ActionsDropdownItem,{className:"js-group-update",onClick:this.handleEditClick},Object(c.translate)("update_details")),s.createElement(S.ActionsDropdownDivider,null),s.createElement(S.ActionsDropdownItem,{className:"js-group-delete",destructive:!0,onClick:this.handleDeleteClick},Object(c.translate)("delete")))),this.state.deleteForm&&s.createElement(y,{group:e,onClose:this.closeDeleteForm,onSubmit:this.handleDeleteFormSubmit}),this.state.editForm&&s.createElement(E,{confirmButtonText:Object(c.translate)("update_verb"),group:e,header:Object(c.translate)("groups.update_group"),onClose:this.closeEditForm,onSubmit:this.handleEditFormSubmit}))}}function B(e){return s.createElement("div",{className:"boxed-group boxed-group-inner"},s.createElement("table",{className:"data zebra zebra-hover",id:"groups-list"},s.createElement("thead",null,s.createElement("tr",null,s.createElement("th",null),s.createElement("th",{className:"nowrap"},Object(c.translate)("members")),s.createElement("th",{className:"nowrap"},Object(c.translate)("description")),s.createElement("th",null))),s.createElement("tbody",null,e.showAnyone&&s.createElement("tr",{className:"js-anyone",key:"anyone"},s.createElement("td",{className:"width-20"},s.createElement("strong",{className:"js-group-name"},Object(c.translate)("groups.anyone"))),s.createElement("td",{className:"width-10"}),s.createElement("td",{className:"width-40",colSpan:2},s.createElement("span",{className:"js-group-description"},Object(c.translate)("user_groups.anyone.description")))),j()(e.groups,e=>e.name.toLowerCase()).map(t=>s.createElement(L,{group:t,key:t.id,onDelete:e.onDelete,onEdit:e.onEdit,onEditMembers:e.onEditMembers,organization:e.organization})))))}function G(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,s)}return n}function W(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?G(Object(n),!0).forEach((function(t){A(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):G(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function A(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class I extends s.PureComponent{constructor(){super(...arguments),this.mounted=!1,this.state={loading:!0,query:""},this.makeFetchGroupsRequest=e=>(this.setState({loading:!0}),Object(u.f)(W({organization:this.organization,q:this.state.query},e))),this.stopLoading=()=>{this.mounted&&this.setState({loading:!1})},this.fetchGroups=e=>{this.makeFetchGroupsRequest(e).then(({groups:e,paging:t})=>{this.mounted&&this.setState({groups:e,loading:!1,paging:t})},this.stopLoading)},this.fetchMoreGroups=()=>{const{paging:e}=this.state;e&&e.total>e.pageIndex*e.pageSize&&this.makeFetchGroupsRequest({p:e.pageIndex+1}).then(({groups:e,paging:t})=>{this.mounted&&this.setState(({groups:n=[]})=>({groups:[...n,...e],loading:!1,paging:t}))},this.stopLoading)},this.search=e=>{this.fetchGroups({q:e}),this.setState({query:e})},this.refresh=()=>{this.fetchGroups({q:this.state.query})},this.handleCreate=e=>Object(u.b)(W({},e,{organization:this.organization})).then(e=>{this.mounted&&this.setState(({groups:t=[]})=>({groups:[...t,e]}))}),this.handleDelete=e=>Object(u.c)({name:e,organization:this.organization}).then(()=>{this.mounted&&this.setState(({groups:t=[]})=>({groups:t.filter(t=>t.name!==e)}))}),this.handleEdit=e=>Object(u.g)(e).then(()=>{this.mounted&&this.setState(({groups:t=[]})=>({groups:t.map(t=>t.id===e.id?W({},t,{},e):t)}))})}componentDidMount(){this.mounted=!0,this.fetchGroups()}componentWillUnmount(){this.mounted=!1}get organization(){return this.props.organization&&this.props.organization.key}render(){const{groups:e,loading:t,paging:n,query:r}=this.state,i=void 0===this.props.organization&&"anyone".includes(r.toLowerCase());return s.createElement(s.Fragment,null,s.createElement(m.a,{suggestions:"user_groups"}),s.createElement(a.a,{defer:!1,title:Object(c.translate)("user_groups.page")}),s.createElement("div",{className:"page page-limited",id:"groups-page"},s.createElement(f,{loading:t,onCreate:this.handleCreate}),s.createElement(l.a,{className:"big-spacer-bottom",id:"groups-search",minLength:2,onChange:this.search,placeholder:Object(c.translate)("search.search_by_name"),value:r}),void 0!==e&&s.createElement(B,{groups:e,onDelete:this.handleDelete,onEdit:this.handleEdit,onEditMembers:this.refresh,organization:this.organization,showAnyone:i}),void 0!==e&&void 0!==n&&s.createElement("div",{id:"groups-list-footer"},s.createElement(o.a,{count:i?e.length+1:e.length,loadMore:this.fetchMoreGroups,ready:!t,total:i?n.total+1:n.total}))))}}},333:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var s=n(2),a=n(360);function r({suggestions:e}){return s.createElement(a.a.Consumer,null,({addSuggestions:t,removeSuggestions:n})=>s.createElement(o,{addSuggestions:t,removeSuggestions:n,suggestions:e}))}class o extends s.PureComponent{componentDidMount(){this.props.addSuggestions(this.props.suggestions)}componentDidUpdate(e){e.suggestions!==this.props.suggestions&&(this.props.removeSuggestions(this.props.suggestions),this.props.addSuggestions(e.suggestions))}componentWillUnmount(){this.props.removeSuggestions(this.props.suggestions)}render(){return null}}},686:function(e,t,n){"use strict";n.d(t,"f",(function(){return r})),n.d(t,"d",(function(){return o})),n.d(t,"a",(function(){return i})),n.d(t,"e",(function(){return l})),n.d(t,"b",(function(){return c})),n.d(t,"g",(function(){return u})),n.d(t,"c",(function(){return m}));var s=n(9),a=n(326);function r(e){return Object(s.getJSON)("/api/user_groups/search",e).catch(a.a)}function o(e){return Object(s.getJSON)("/api/user_groups/users",e).catch(a.a)}function i(e){return Object(s.post)("/api/user_groups/add_user",e).catch(a.a)}function l(e){return Object(s.post)("/api/user_groups/remove_user",e).catch(a.a)}function c(e){return Object(s.postJSON)("/api/user_groups/create",e).then(e=>e.group,a.a)}function u(e){return Object(s.post)("/api/user_groups/update",e).catch(a.a)}function m(e){return Object(s.post)("/api/user_groups/delete",e).catch(a.a)}}}]);
//# sourceMappingURL=20.m.ca2cb9f1.chunk.js.map