(window.webpackJsonp=window.webpackJsonp||[]).push([[325],{1101:function(e,t,n){"use strict";n.d(t,"a",(function(){return y}));var a=n(2),r=n(312),o=n(318),s=n.n(o),l=n(31),i=n(618),c=n(319),u=n(375),m=n.n(u),d=n(316),p=n.n(d),h=n(356),f=n.n(h),g=n(816),b=n.n(g),k=n(396);class E extends a.PureComponent{constructor(){super(...arguments),this.mounted=!1,this.state={loading:!1,showConfirmation:!1},this.handleClick=()=>{this.state.showConfirmation?this.handleRevoke().then(()=>{this.mounted&&this.setState({showConfirmation:!1})}):this.setState({showConfirmation:!0})},this.handleRevoke=()=>(this.setState({loading:!0}),Object(i.c)({login:this.props.login,name:this.props.token.name}).then(()=>this.props.onRevokeToken(this.props.token),()=>{this.mounted&&this.setState({loading:!1})}))}componentDidMount(){this.mounted=!0}componentWillUnmount(){this.mounted=!1}render(){const{deleteConfirmation:e,token:t}=this.props,{loading:n,showConfirmation:o}=this.state;return a.createElement("tr",null,a.createElement("td",null,a.createElement(p.a,{overlay:t.name},a.createElement("span",null,Object(k.limitComponentName)(t.name)))),a.createElement("td",{className:"nowrap"},a.createElement(b.a,{date:t.lastConnectionDate})),a.createElement("td",{className:"thin nowrap text-right"},a.createElement(f.a,{date:t.createdAt,long:!0})),a.createElement("td",{className:"thin nowrap text-right"},a.createElement(s.a,{loading:n},a.createElement("i",{className:"deferred-spinner-placeholder"})),"modal"===e?a.createElement(m.a,{confirmButtonText:Object(l.translate)("users.tokens.revoke_token"),isDestructive:!0,modalBody:a.createElement(c.FormattedMessage,{defaultMessage:Object(l.translate)("users.tokens.sure_X"),id:"users.tokens.sure_X",values:{token:a.createElement("strong",null,t.name)}}),modalHeader:Object(l.translate)("users.tokens.revoke_token"),onConfirm:this.handleRevoke},({onClick:e})=>a.createElement(r.Button,{className:"spacer-left button-red input-small",disabled:n,onClick:e,title:Object(l.translate)("users.tokens.revoke_token")},Object(l.translate)("users.tokens.revoke"))):a.createElement(r.Button,{className:"button-red input-small spacer-left",disabled:n,onClick:this.handleClick},o?Object(l.translate)("users.tokens.sure"):Object(l.translate)("users.tokens.revoke"))))}}var v=n(373),_=n(325);function w({token:e}){return a.createElement("div",{className:"panel panel-white big-spacer-top"},a.createElement(_.Alert,{variant:"warning"},Object(l.translateWithParameters)("users.tokens.new_token_created",e.name)),a.createElement(v.ClipboardButton,{copyValue:e.token}),a.createElement("code",{className:"big-spacer-left text-success"},e.token))}class y extends a.PureComponent{constructor(){super(...arguments),this.mounted=!1,this.state={generating:!1,loading:!0,newTokenName:"",tokens:[]},this.fetchTokens=()=>{this.setState({loading:!0}),Object(i.b)(this.props.login).then(e=>{this.mounted&&this.setState({loading:!1,tokens:e})},()=>{this.mounted&&this.setState({loading:!1})})},this.updateTokensCount=()=>{this.props.updateTokensCount&&this.props.updateTokensCount(this.props.login,this.state.tokens.length)},this.handleGenerateToken=e=>{e.preventDefault(),this.state.newTokenName.length>0&&(this.setState({generating:!0}),Object(i.a)({name:this.state.newTokenName,login:this.props.login}).then(e=>{this.mounted&&this.setState(t=>{const n=[...t.tokens,{name:e.name,createdAt:e.createdAt}];return{generating:!1,newToken:e,newTokenName:"",tokens:n}},this.updateTokensCount)},()=>{this.mounted&&this.setState({generating:!1})}))},this.handleRevokeToken=e=>{this.setState(t=>({tokens:t.tokens.filter(t=>t.name!==e.name)}),this.updateTokensCount)},this.handleNewTokenChange=e=>this.setState({newTokenName:e.currentTarget.value})}componentDidMount(){this.mounted=!0,this.fetchTokens()}componentWillUnmount(){this.mounted=!1}renderItems(){const{tokens:e}=this.state;return e.length<=0?a.createElement("tr",null,a.createElement("td",{className:"note",colSpan:3},Object(l.translate)("users.no_tokens"))):e.map(e=>a.createElement(E,{deleteConfirmation:this.props.deleteConfirmation,key:e.name,login:this.props.login,onRevokeToken:this.handleRevokeToken,token:e}))}render(){const{generating:e,loading:t,newToken:n,newTokenName:o,tokens:i}=this.state,c=a.createElement("tr",null,a.createElement("td",null,a.createElement("i",{className:"spinner"})));return a.createElement(a.Fragment,null,a.createElement("h3",{className:"spacer-bottom"},Object(l.translate)("users.generate_tokens")),a.createElement("form",{autoComplete:"off",className:"display-flex-center",id:"generate-token-form",onSubmit:this.handleGenerateToken},a.createElement("input",{className:"input-large spacer-right",maxLength:100,onChange:this.handleNewTokenChange,placeholder:Object(l.translate)("users.enter_token_name"),required:!0,type:"text",value:o}),a.createElement(r.SubmitButton,{className:"js-generate-token",disabled:e||o.length<=0},Object(l.translate)("users.generate"))),n&&a.createElement(w,{token:n}),a.createElement("table",{className:"data zebra big-spacer-top"},a.createElement("thead",null,a.createElement("tr",null,a.createElement("th",null,Object(l.translate)("name")),a.createElement("th",null,Object(l.translate)("my_account.tokens_last_usage")),a.createElement("th",{className:"text-right"},Object(l.translate)("created")),a.createElement("th",null))),a.createElement("tbody",null,a.createElement(s.a,{customSpinner:c,loading:t&&i.length<=0},this.renderItems()))))}}},1913:function(e,t,n){"use strict";n.r(t),n.d(t,"Security",(function(){return f}));var a=n(2),r=n(332),o=n(321),s=n(31),l=n(323),i=n(312),c=n(325),u=n(436);class m extends a.Component{constructor(){super(...arguments),this.state={success:!1},this.handleSuccessfulChange=()=>{this.oldPassword.value="",this.password.value="",this.passwordConfirmation.value="",this.setState({success:!0,errors:void 0})},this.setErrors=e=>{this.setState({success:!1,errors:e})},this.handleChangePassword=e=>{e.preventDefault();const{user:t}=this.props,n=this.oldPassword.value,a=this.password.value;a!==this.passwordConfirmation.value?(this.password.focus(),this.setErrors([Object(s.translate)("user.password_doesnt_match_confirmation")])):Object(u.a)({login:t.login,password:a,previousPassword:n}).then(this.handleSuccessfulChange,()=>{})}}render(){const{success:e,errors:t}=this.state;return a.createElement("section",{className:"boxed-group"},a.createElement("h2",{className:"spacer-bottom"},Object(s.translate)("my_profile.password.title")),a.createElement("form",{className:"boxed-group-inner",onSubmit:this.handleChangePassword},e&&a.createElement(c.Alert,{variant:"success"},Object(s.translate)("my_profile.password.changed")),t&&t.map((e,t)=>a.createElement(c.Alert,{key:t,variant:"error"},e)),a.createElement("div",{className:"form-field"},a.createElement("label",{htmlFor:"old_password"},Object(s.translate)("my_profile.password.old"),a.createElement("em",{className:"mandatory"},"*")),a.createElement("input",{autoComplete:"off",id:"old_password",name:"old_password",ref:e=>this.oldPassword=e,required:!0,type:"password"})),a.createElement("div",{className:"form-field"},a.createElement("label",{htmlFor:"password"},Object(s.translate)("my_profile.password.new"),a.createElement("em",{className:"mandatory"},"*")),a.createElement("input",{autoComplete:"off",id:"password",name:"password",ref:e=>this.password=e,required:!0,type:"password"})),a.createElement("div",{className:"form-field"},a.createElement("label",{htmlFor:"password_confirmation"},Object(s.translate)("my_profile.password.confirm"),a.createElement("em",{className:"mandatory"},"*")),a.createElement("input",{autoComplete:"off",id:"password_confirmation",name:"password_confirmation",ref:e=>this.passwordConfirmation=e,required:!0,type:"password"})),a.createElement("div",{className:"form-field"},a.createElement(i.SubmitButton,{id:"change-password"},Object(s.translate)("my_profile.password.submit")))))}}var d=n(427),p=n(1101);function h({login:e}){return a.createElement("div",{className:"boxed-group"},a.createElement("h2",null,Object(s.translate)("users.tokens")),a.createElement("div",{className:"boxed-group-inner"},a.createElement("div",{className:"big-spacer-bottom big-spacer-right markdown"},a.createElement(d.a,{message:Object(s.translate)("my_account.tokens_description")})),a.createElement(p.a,{deleteConfirmation:"modal",login:e})))}function f({user:e}){return a.createElement("div",{className:"account-body account-container"},a.createElement(r.a,{defer:!1,title:Object(s.translate)("my_account.security")}),a.createElement(h,{login:e.login}),e.local&&a.createElement(m,{user:e}))}t.default=Object(o.connect)(e=>({user:Object(l.getCurrentUser)(e)}))(f)},354:function(e,t,n){"use strict";var a=this&&this.__assign||function(){return(a=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(319),s=n(26);t.formatterOption={year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric"},t.default=function(e){var n=e.children,l=e.date;return r.createElement(o.FormattedDate,a({value:s.parseDate(l)},t.formatterOption),n)}},364:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=n(2),r=n(319),o=n(26);t.default=function(e){var t=e.children,n=e.date;return a.createElement(r.FormattedRelative,{value:o.parseDate(n)},t)}},375:function(e,t,n){"use strict";var a,r=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},s=this&&this.__rest||function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n};Object.defineProperty(t,"__esModule",{value:!0});var l=n(2),i=n(348),c=n(376),u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.renderConfirmModal=function(e){var n=e.onClose,a=t.props,r=(a.children,a.modalBody),c=a.modalHeader,u=a.modalHeaderDescription,m=s(a,["children","modalBody","modalHeader","modalHeaderDescription"]);return l.createElement(i.default,o({header:c,headerDescription:u,onClose:n},m),r)},t}return r(t,e),t.prototype.render=function(){return l.createElement(c.default,{modal:this.renderConfirmModal},this.props.children)},t}(l.PureComponent);t.default=u},376:function(e,t,n){"use strict";var a,r=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(2),s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.mounted=!1,t.state={modal:!1},t.handleButtonClick=function(){t.setState({modal:!0})},t.handleFormSubmit=function(e){e&&e.preventDefault(),t.setState({modal:!0})},t.handleCloseModal=function(){t.mounted&&t.setState({modal:!1})},t}return r(t,e),t.prototype.componentDidMount=function(){this.mounted=!0},t.prototype.componentWillUnmount=function(){this.mounted=!1},t.prototype.render=function(){return o.createElement(o.Fragment,null,this.props.children({onClick:this.handleButtonClick,onFormSubmit:this.handleFormSubmit}),this.state.modal&&this.props.modal({onClose:this.handleCloseModal}))},t}(o.PureComponent);t.default=s},618:function(e,t,n){"use strict";n.d(t,"b",(function(){return o})),n.d(t,"a",(function(){return s})),n.d(t,"c",(function(){return l}));var a=n(9),r=n(326);function o(e){return Object(a.getJSON)("/api/user_tokens/search",{login:e}).then(e=>e.userTokens,r.a)}function s(e){return Object(a.postJSON)("/api/user_tokens/generate",e).catch(r.a)}function l(e){return Object(a.post)("/api/user_tokens/revoke",e).catch(r.a)}},816:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=n(726),r=n(2),o=n(31),s=n(316),l=n(364),i=n(354);t.default=function(e){var t=e.children,n=void 0===t?function(e){return e}:t,c=e.date;return c?a.differenceInHours(Date.now(),c)<1?n(o.translate("less_than_1_hour_ago")):r.createElement(s.default,{overlay:r.createElement(i.default,{date:c})},r.createElement("span",null,r.createElement(l.default,{date:c},n))):n(o.translate("never"))}}}]);
//# sourceMappingURL=325.m.7450b533.chunk.js.map